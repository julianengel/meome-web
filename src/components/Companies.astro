---
// src/components/projects.astro
import { projects } from "../data/projects";

// Extract unique types from data and add 'All'
const filterTypes = [
    "All",
    ...new Set(projects.map((company) => company.type)),
] as const;

const getTagColor = (type: (typeof projects)[number]["type"]) => {
    switch (type) {
        case "Founded":
            return "bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400";
        case "Invested":
            return "bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400";
        case "Brand":
            return "bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400";
        case "Project":
            return "bg-amber-50 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400";
        default:
            return "bg-gray-50 dark:bg-gray-900/30 text-gray-700 dark:text-gray-400";
    }
};
---

<section id="projects" class="py-24 bg-white dark:bg-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16 fade-in">
            <h2
                class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-4xl"
            >
                Our Portfolio
            </h2>
            <p class="mt-4 text-lg text-gray-600 dark:text-gray-300">
                Building and scaling ventures that create meaningful impact.
            </p>
        </div>

        <!-- Filter Buttons -->
        <div
            class="mb-8 flex flex-wrap items-center justify-center gap-3 fade-in"
        >
            <svg
                class="h-5 w-5 text-gray-400 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                ></path>
            </svg>
            {
                filterTypes.map((type) => (
                    <button
                        data-filter={type}
                        class:list={[
                            "filter-btn px-4 py-2 rounded-full text-sm font-medium transition-colors",
                            type === "All"
                                ? "bg-indigo-600 text-white"
                                : "bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700",
                        ]}
                    >
                        {type}
                    </button>
                ))
            }
        </div>

        <!-- Projects Grid -->
        <div class="relative">
            <div class="px-4 -mx-4 sm:px-0 sm:mx-0">
                <div
                    id="projects-scroll"
                    class="flex space-x-6 overflow-x-auto snap-x snap-mandatory scrollbar-hide scroll-smooth pb-8"
                >
                    {
                        projects.map((project, index) => (
                            <div
                                data-type={project.type}
                                class="company-card flex-shrink-0 w-[85%] sm:w-[calc(33.333%-1rem)] first:pl-8 last:pr-8 snap-center slide-in"
                                data-index={index}
                            >
                                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden h-full">
                                    <div class="p-6">
                                        <div class="h-16 mb-6 flex items-center justify-center bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                                            <img
                                                src={project.logo}
                                                alt={`${project.name} logo`}
                                                class="h-full w-auto object-contain"
                                            />
                                        </div>

                                        <div class="flex items-center justify-between mb-4">
                                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                                {project.name}
                                            </h3>
                                            <span
                                                class={`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${getTagColor(project.type)}`}
                                            >
                                                {project.type}
                                            </span>
                                        </div>

                                        <p class="text-gray-600 dark:text-gray-300 mb-4">
                                            {project.description}
                                        </p>

                                        <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                                <svg
                                                    class="h-5 w-5 mr-2"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                                                    />
                                                </svg>
                                                {project.industry}
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mt-2">
                                                <svg
                                                    class="h-5 w-5 mr-2"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                                                    />
                                                </svg>
                                                {project.company}
                                            </div>
                                        </div>

                                        <div class="mt-6">
                                            <a
                                                href={`/projects/${project.id}`}
                                                class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300"
                                            >
                                                Learn more
                                                <svg
                                                    class="ml-2 h-4 w-4"
                                                    fill="none"
                                                    stroke="currentColor"
                                                    viewBox="0 0 24 24"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 5l7 7-7 7"
                                                    />
                                                </svg>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))
                    }
                </div>
            </div>

            <!-- Navigation Arrows -->
            <div class="flex justify-center mt-8 space-x-4">
                <button
                    id="scroll-left"
                    class="p-2 rounded-full bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm"
                    aria-label="Scroll left"
                >
                    <svg
                        class="h-6 w-6 text-gray-900 dark:text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <button
                    id="scroll-right"
                    class="p-2 rounded-full bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm"
                    aria-label="Scroll right"
                >
                    <svg
                        class="h-6 w-6 text-gray-900 dark:text-white"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</section>

<style>
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .company-card {
        transition:
            opacity 0.3s ease,
            transform 0.3s ease;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
</style>

<script>
    // Handle both filtering and animations
    function initializeProjectsSection() {
        // Scroll functionality
        const scrollContainer = document.getElementById("projects-scroll");
        const scrollLeftBtn = document.getElementById("scroll-left");
        const scrollRightBtn = document.getElementById("scroll-right");

        if (scrollContainer && scrollLeftBtn && scrollRightBtn) {
            const scroll = (direction: "left" | "right") => {
                const firstCard = scrollContainer.querySelector(
                    ".company-card",
                ) as HTMLElement;
                const cardWidth = firstCard?.offsetWidth || 0;
                const scrollAmount =
                    direction === "left" ? -cardWidth : cardWidth;

                scrollContainer.scrollBy({
                    left: scrollAmount,
                    behavior: "smooth",
                });
            };

            scrollLeftBtn.addEventListener("click", () => scroll("left"));
            scrollRightBtn.addEventListener("click", () => scroll("right"));

            // Update button states
            const updateButtonStates = () => {
                if (!scrollContainer || !scrollLeftBtn || !scrollRightBtn)
                    return;

                const isAtStart = scrollContainer.scrollLeft === 0;
                const isAtEnd =
                    scrollContainer.scrollLeft + scrollContainer.clientWidth >=
                    scrollContainer.scrollWidth - 10;

                (scrollLeftBtn as HTMLElement).style.opacity = isAtStart
                    ? "0.5"
                    : "1";
                (scrollRightBtn as HTMLElement).style.opacity = isAtEnd
                    ? "0.5"
                    : "1";
            };

            scrollContainer.addEventListener("scroll", updateButtonStates);
            window.addEventListener("resize", updateButtonStates);
            updateButtonStates();
        }

        // Filtering functionality
        const filterButtons = document.querySelectorAll(".filter-btn");
        const companyCards = document.querySelectorAll(
            ".company-card",
        ) as NodeListOf<HTMLElement>;

        filterButtons.forEach((button) => {
            button.addEventListener("click", () => {
                // Update button styles
                filterButtons.forEach((btn) => {
                    btn.classList.remove("bg-indigo-600", "text-white");
                    btn.classList.add(
                        "bg-gray-100",
                        "dark:bg-gray-800",
                        "text-gray-600",
                        "dark:text-gray-300",
                    );
                });

                button.classList.remove(
                    "bg-gray-100",
                    "dark:bg-gray-800",
                    "text-gray-600",
                    "dark:text-gray-300",
                );
                button.classList.add("bg-indigo-600", "text-white");

                const filterType = button.getAttribute("data-filter");

                // Simple display toggle without animation
                companyCards.forEach((card) => {
                    const show =
                        filterType === "All" ||
                        card.getAttribute("data-type") === filterType;
                    card.style.display = show ? "" : "none";
                });
            });
        });
    }

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", initializeProjectsSection);

    // Re-initialize after Astro page transitions
    document.addEventListener("astro:after-swap", initializeProjectsSection);
</script>
